<!DOCTYPE HTML>
<!--
	Müller András 2015.07.21.
	Segédeszköz Excel-bufferes programkódok generálásához.
-->
<html>
	<head>
		<meta charset="utf-8">
		<title>Excel-buffer forráskód generálás</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	</head>

	<body>
		<div class="container-fluid">
			<div class="page-header">
				<h1>
					C/AL-forráskód generálás Excel-bufferhez <small>mező-definíciók alapján</small>
				</h1>
			</div>
			<div class="col-md-4">
				<div class="panel panel-primary">
					<div class="panel-heading">Beállítás</div>
					<div class="panel-body">
						<form id="setup">
							<div class="form-group">
								<label for="source">Excel-buffer változó neve</label>
								<input type="text"
									   class="form-control"
									   placeholder="Add meg az Excel-buffer változó nevét."
									   id="variable-name" required>
							</div>
							<div class="form-group">
								<label for="source">Exportálandó rekordváltozó neve</label>
								<input type="text"
									   class="form-control"
									   placeholder="Add meg a rekordváltozó nevét, amiből kimenetet szeretnél készíteni."
									   id="table-name" required>
							</div>
							<div class="form-group">
								<label for="source">Forrás</label>
								<textarea class="form-control"
										  placeholder="Másold ide a mezők definícióit."
										  rows="5"
										  id="source"></textarea>
									<p class="help-block">Az Object Designerben válaszd ki a táblát, nyisd meg a Design-felületet és a mezőlista bal felső sarkába kattintva jelöld ki az összes sort, majd használd a <kbd><kbd>Ctrl</kbd> + <kbd>c</kbd></kbd> billentyűkombinációt.</p>
							</div>
							<div class="checkbox">
								<label>
									<input type="checkbox" id="nav2013p" aria-label="NAV2013+"> NAV2013+
								</label>
								<p class="help-block">Pipáld be, ha NAV2013, vagy későbbi verzióban szeretnéd az eredményt használni.</p>
							</div>
								<div class="panel panel-info">
									<div class="panel-heading">Fejléc stílus</div>
									<div class="panel-body">
										<label class="checkbox-inline">
											<input type="checkbox" id="header-bold"> Félkövér
										</label>
										<label class="checkbox-inline">
											<input type="checkbox" id="header-italic"> Dőlt
										</label>
										<label class="checkbox-inline">
											<input type="checkbox" id="header-underline"> Aláhúzott
										</label>
									</div>
								</div>
								<div class="panel panel-info">
									<div class="panel-heading">Törzs stílus</div>
									<div class="panel-body">
										<label class="checkbox-inline">
											<input type="checkbox" id="body-bold"> Félkövér
										</label>
										<label class="checkbox-inline">
											<input type="checkbox" id="body-italic" aria-label="Header Italic"> Dőlt
										</label>
										<label class="checkbox-inline">
											<input type="checkbox" id="body-underline" aria-label="Header Underline"> Aláhúzott
										</label>          
									</div>
								</div>    
						</form>
					</div>
					<div class="panel-footer">
						<button onclick="transform()" class="btn btn-primary">Mehet</button>
						<button onclick="reset()" class="btn btn-default">Visszaállítás</button>
					</div>
				</div>
			</div>
			<div class="col-md-8">
				<div class="panel panel-success">
					<div class="panel-heading">Eredmény</div>
					<div class="panel-body">
						<form id="results">
							<div class="form-group">
								<label for="result-header">Fejléc</label>
								<textarea class="form-control" rows="13" id="result-header"></textarea>
							</div>
							<div class="form-group">
								<label for="result-body">Törzs</label>
								<textarea class="form-control" rows="13" id="result-body"></textarea>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script type="text/javascript">

			function transform() {
				var variableName = document.getElementById('variable-name').value;
				var tableName = document.getElementById('table-name').value;
				var lines = document.getElementById('source').value.split('\n');

				var isNew = document.getElementById('nav2013p').checked ? true : false;

				var headerBold = document.getElementById('header-bold').checked ? 'TRUE' : 'FALSE';
				var headerItalic = document.getElementById('header-italic').checked ? 'TRUE' : 'FALSE';
				var headerUnderline = document.getElementById('header-underline').checked ? 'TRUE' : 'FALSE';
				var bodyBold = document.getElementById('body-bold').checked ? 'TRUE' : 'FALSE';
				var bodyItalic = document.getElementById('body-italic').checked ? 'TRUE' : 'FALSE';
				var bodyUnderline = document.getElementById('body-underline').checked ? 'TRUE' : 'FALSE';

				var header = document.getElementById('result-header');
				var body = document.getElementById('result-body');

				header.value = '';
				body.value = '';

				for (var i = 1; i < lines.length; i++) {
					var fields = lines[i].split('\t');

					header.value += (i == 1 ? '' : '\n')
						+ variableName
						+'.AddColumn(\"'
						+ tableName
						+ '\".FIELDCAPTION(\"'
						+ (fields[2])
						+ '\"), FALSE, \'\', ' + headerBold + ', '
						+ headerItalic + ', ' + headerUnderline + ', \'\''
						+ (isNew ? (', ' + variableName + '.\"Cell Type\"::Text);') : ');');


					var cellType;

					switch (fields[3]) {
						case 'Integer':
						case 'BigInteger':
						case 'Decimal':
							cellType = 'Number';
							break;
						case 'Date':
							cellType = 'Date';
							break;
						case 'Time':
						case 'DateTime':
							cellType = 'Time';
							break;
						default:
							cellType = 'Text';
					}

					body.value += (i == 1 ? '' : '\n')
						+ variableName
						+'.AddColumn(\"'
						+ (fields[2])
						+ '\", FALSE, \'\', ' + bodyBold + ', '
						+ bodyItalic + ', ' + bodyUnderline + ', \'\''
						+ (isNew
							? (', '
								+ variableName
								+ '.\"Cell Type\"::'
								+ cellType
								+ ');')
							: ');');
				}
			}

			function reset() {
				document.getElementById('setup').reset();
				document.getElementById('results').reset();
			}

		</script>

	</body>
</html>